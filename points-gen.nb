(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 13.3' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     16131,        406]
NotebookOptionsPosition[     15336,        385]
NotebookOutlinePosition[     15761,        402]
CellTagsIndexPosition[     15718,        399]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[{
 RowBox[{
  RowBox[{"dim", "=", "50"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"wt", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"Ramp", "@", 
      RowBox[{"N", "[", 
       RowBox[{
        RowBox[{"Sqrt", "[", 
         RowBox[{
          RowBox[{"x", "*", 
           RowBox[{"(", 
            RowBox[{"dim", "+", "1", "-", "x"}], ")"}]}], "+", 
          RowBox[{"y", "*", 
           RowBox[{"(", 
            RowBox[{"dim", "+", "1", "-", "y"}], ")"}]}]}], "]"}], "-", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dim", "+", "1"}], ")"}], "/", "2"}]}], "]"}]}], ",", 
     RowBox[{"{", 
      RowBox[{"x", ",", "1", ",", "dim"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"y", ",", "1", ",", "dim"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"topoint", "[", 
   RowBox[{"x0_", ",", "y0_", ",", "i_"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"x", ",", "y", ",", "z", ",", "m"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"x", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"x0", "/", 
         RowBox[{"(", 
          RowBox[{"dim", "+", "1"}], ")"}]}], "*", "2"}], "-", "1"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"y", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"y0", "/", 
         RowBox[{"(", 
          RowBox[{"dim", "+", "1"}], ")"}]}], "*", "2"}], "-", "1"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"m", "=", 
      RowBox[{"mxs", "[", 
       RowBox[{"[", "i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"z", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"RandomReal", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"-", "#"}], ",", "#"}], "}"}], "]"}], "&"}], "@", 
       RowBox[{"Sqrt", "[", 
        RowBox[{"1", "-", 
         RowBox[{"x", "*", "x"}], "-", 
         RowBox[{"y", "*", "y"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"m", ".", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"x", "+", 
         RowBox[{"RandomReal", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"-", "1"}], "/", 
             RowBox[{"(", 
              RowBox[{"dim", "+", "1"}], ")"}]}], ",", 
            RowBox[{"1", "/", 
             RowBox[{"(", 
              RowBox[{"dim", "+", "1"}], ")"}]}]}], "}"}], "]"}]}], ",", 
        RowBox[{"y", "+", 
         RowBox[{"RandomReal", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"-", "1"}], "/", 
             RowBox[{"(", 
              RowBox[{"dim", "+", "1"}], ")"}]}], ",", 
            RowBox[{"1", "/", 
             RowBox[{"(", 
              RowBox[{"dim", "+", "1"}], ")"}]}]}], "}"}], "]"}]}], ",", 
        "z"}], "}"}]}]}]}], "\[IndentingNewLine]", 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"quat", "[", "mx_", "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"v", ",", "c", ",", "s", ",", "rc", ",", "a"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"v", "=", 
      RowBox[{"First", "@", 
       RowBox[{"NullSpace", "[", 
        RowBox[{"mx", "-", 
         RowBox[{"IdentityMatrix", "[", "3", "]"}]}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"c", ",", "rc", ",", "s"}], "}"}], "=", 
      RowBox[{"LinearSolve", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Flatten", "@", 
            RowBox[{"IdentityMatrix", "@", "3"}]}], ",", 
           RowBox[{"Flatten", "@", 
            RowBox[{"KroneckerProduct", "[", 
             RowBox[{"v", ",", "v"}], "]"}]}], ",", 
           RowBox[{"Flatten", "[", 
            RowBox[{
             RowBox[{"LeviCivitaTensor", "@", "3"}], " ", ".", "v"}], "]"}]}],
           "}"}], "\[Transpose]"}], ",", 
        RowBox[{"Flatten", "@", "mx"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"a", "=", 
      RowBox[{"ArcTan", "[", 
       RowBox[{"c", ",", "s"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        RowBox[{"Sin", "[", 
         RowBox[{"a", "/", "2"}], "]"}], "*", "v"}], ")"}], "~", "Join", "~", 
      
      RowBox[{"{", 
       RowBox[{"Cos", "[", 
        RowBox[{"a", "/", "2"}], "]"}], "}"}]}]}]}], "\[IndentingNewLine]", 
   "]"}]}]}], "Input",
 CellChangeTimes->{{3.91863372864221*^9, 3.918633769688959*^9}, {
   3.918633812939725*^9, 3.918633889320024*^9}, 3.9186352589919357`*^9, {
   3.918635321738714*^9, 3.918635338819067*^9}, {3.91863585612963*^9, 
   3.918635897889673*^9}, {3.9186359459468*^9, 3.918635950575879*^9}, {
   3.918636180830762*^9, 3.918636214457189*^9}, {3.918716578557626*^9, 
   3.9187165787369747`*^9}},
 CellLabel->"In[47]:=",ExpressionUUID->"bc950db2-1610-4d34-a3dd-411ab76877fb"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"img", "[", "t_", "]"}], ":=", 
  RowBox[{"ColorConvert", "[", 
   RowBox[{
    RowBox[{"Rasterize", "[", 
     RowBox[{"t", ",", 
      RowBox[{"RasterSize", "->", 
       RowBox[{"{", 
        RowBox[{"dim", ",", "dim"}], "}"}]}]}], "]"}], ",", 
    "\"\<Grayscale\>\""}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"imgs", "=", 
  RowBox[{"img", "/@", 
   RowBox[{"{", 
    RowBox[{
    "\"\<1\>\"", ",", "\"\<2\>\"", ",", "\"\<3\>\"", ",", "\"\<4\>\"", ",", 
     "\"\<5\>\"", ",", "\"\<6\>\""}], "}"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"mxs", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"RandomVariate", "[", 
      RowBox[{"CircularRealMatrixDistribution", "[", "3", "]"}], "]"}], ",", 
     RowBox[{"Length", "[", "imgs", "]"}]}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"mxs", "*=", 
   RowBox[{"Det", "/@", "mxs"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"dist", "=", 
   RowBox[{
    RowBox[{"Flatten", "[", 
     RowBox[{
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"1.0", "-", 
           RowBox[{"0.95", "*", 
            RowBox[{"ImageData", "@", "img"}]}]}], ")"}], "*", "wt"}], ",", 
        RowBox[{"{", 
         RowBox[{"img", ",", "imgs"}], "}"}]}], "]"}], ",", "2"}], "]"}], "->",
     "\[IndentingNewLine]", 
    RowBox[{"Flatten", "[", 
     RowBox[{
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"x", ",", "y", ",", "i"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "1", ",", 
          RowBox[{"Length", "@", "imgs"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"y", ",", "1", ",", "dim"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"x", ",", "1", ",", "dim"}], "}"}]}], "]"}], ",", "2"}], 
     "]"}]}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.91863372864221*^9, 3.918633769688959*^9}, {
   3.918633812939725*^9, 3.918633889320024*^9}, 3.9186352589919357`*^9, {
   3.918635321738714*^9, 3.918635338819067*^9}, {3.91863585612963*^9, 
   3.918635897889673*^9}, {3.9186359459468*^9, 3.918635950575879*^9}, {
   3.918636180830762*^9, 3.91863622068836*^9}, {3.91863738646677*^9, 
   3.918637402289639*^9}, {3.918654225121064*^9, 3.918654226099607*^9}, 
   3.918662127908791*^9, 3.918662175131229*^9, {3.9187041688983393`*^9, 
   3.918704170361326*^9}},
 CellLabel->"In[4]:=",ExpressionUUID->"c4919180-04bb-451b-974f-075b534c4263"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   GraphicsBox[
    TagBox[RasterBox[CompressedData["
1:eJxTTMoPSmNiYGAo5gASQYnljkVFiZXBAkBOaF5xZnpeaopnXklqemqRRRJI
mREU/x8Fo2AQg99HcxgYlhOr+suVra1mwFRNvI61DFBAQx0QkDuqY1THqI4h
ouNTJQQA60g/COsVAR1vGNDBI6rrGAWjABMAAEGLSR4=
      "], {{0, 16.031250000000004`}, {16.031250000000004`, 0}}, {0, 255},
      ColorFunction->GrayLevel,
      ImageResolution->224.56140350877192`],
     BoxForm`ImageTag["Byte", ColorSpace -> "Grayscale", Interleaving -> None],
     Selectable->False],
    DefaultBaseStyle->"ImageGraphics",
    ImageSizeRaw->{16.031250000000004`, 16.031250000000004`},
    PlotRange->{{0, 16.031250000000004`}, {0, 16.031250000000004`}}], ",", 
   GraphicsBox[
    TagBox[RasterBox[CompressedData["
1:eJxTTMoPSmNiYGAo5gASQYnljkVFiZXBAkBOaF5xZnpeaopnXklqemqRRRJI
mREU/x8Fo2Cwgj/nOuPN5Z3LNv0gUsMZFwYocDlKjPrfHUClXP6lSVogPVMI
a/hRwMAgNucliHkjFqjlMEEd/3oZ/B5A2X/TGRi8/xHWsuIjnP0UaMlDwu5C
Bm7EOAsFlDAwbCVNRxIDw3GSNPxQY2B4QpKOfQwM4SRp+OXLwLCbJB2LGRjC
/pKi4QI/g/AtUjQ8B5axa0jR8M6dgaGFcBJBgI/BDAxZv0jQ8D6UgSH+Kwka
3vozMER/JkHDM2AKTCZFwz1zBob87yRouKTBwFBDiqcPiTEwdPwhQcM6YL5T
62kuy4yJhoByAho+MqADb6rrGAWjAAsAAN+6Nto=
      "], {{0, 16.031250000000004`}, {16.031250000000004`, 0}}, {0, 255},
      ColorFunction->GrayLevel,
      ImageResolution->224.56140350877192`],
     BoxForm`ImageTag["Byte", ColorSpace -> "Grayscale", Interleaving -> None],
     Selectable->False],
    DefaultBaseStyle->"ImageGraphics",
    ImageSizeRaw->{16.031250000000004`, 16.031250000000004`},
    PlotRange->{{0, 16.031250000000004`}, {0, 16.031250000000004`}}], ",", 
   GraphicsBox[
    TagBox[RasterBox[CompressedData["
1:eJxTTMoPSmNiYGAo5gASQYnljkVFiZXBAkBOaF5xZnpeaopnXklqemqRRRJI
mREU/x8Fo2Cwgj+Xpyc5KAZVzHxAnPp/R/wYYKD8HhEaPpaClNpllQVJAmnF
S4R1rAeq6wAb/WWZPAOD+SfCjmp1OQ9jHwbq3kjYkl/fEexEBoYqwjqQwVQG
hjTSdFQwMPSRpOG7DgPDXlI0/KpnYEj+S7z6b4eCGRiCXxKpet2s9kRgBEpO
/E5YLQS4gdNIwXviXQTRweA2l3CMQ8Hf7+9u7e/WY2CwPE68NUDwfSk/A8NZ
krT83wkszUnwDBD882dgWE+aJe0MDJ2k6cgkImE9vo/E+SRG2FWfvRW3wZPS
j1QGBv43BHSAMm3wjncg5q89QH8zLCXkqP8bQAUCl3NKvpcwKNr7iUi7L5u5
4KVP0inC6kHgw+6GeDv5wIqZF4lTPwpGAQYAAOyGNN8=
      "], {{0, 16.031250000000004`}, {16.031250000000004`, 0}}, {0, 255},
      ColorFunction->GrayLevel,
      ImageResolution->224.56140350877192`],
     BoxForm`ImageTag["Byte", ColorSpace -> "Grayscale", Interleaving -> None],
     Selectable->False],
    DefaultBaseStyle->"ImageGraphics",
    ImageSizeRaw->{16.031250000000004`, 16.031250000000004`},
    PlotRange->{{0, 16.031250000000004`}, {0, 16.031250000000004`}}], ",", 
   GraphicsBox[
    TagBox[RasterBox[CompressedData["
1:eJxTTMoPSmNiYGAo5gASQYnljkVFiZXBAkBOaF5xZnpeaopnXklqemqRRRJI
mREU/x8Fo2CQg1fAhBpNioZfcQwk6uhnIFHHHgaGHJJ03JNncL9Hio4vHgxc
Vx+RoONfBQPDnP+3SNCxgoEh7tf/y8TruMDFYPIKSBGt47UJA9eF/yTo+JXE
wLDqPyk6JjEwVP8jRcd+Bga/r/9J0PFQkUHl0X8SdHz1ZWA4/J8EHf+qGRhm
wThE6TjEgAky8erYTLKOCz1IoJCBwQBIrSToMoR2EvPgqI5RMArIAABmiip/

      "], {{0, 16.031250000000004`}, {16.031250000000004`, 0}}, {0, 255},
      ColorFunction->GrayLevel,
      ImageResolution->224.56140350877192`],
     BoxForm`ImageTag["Byte", ColorSpace -> "Grayscale", Interleaving -> None],
     Selectable->False],
    DefaultBaseStyle->"ImageGraphics",
    ImageSizeRaw->{16.031250000000004`, 16.031250000000004`},
    PlotRange->{{0, 16.031250000000004`}, {0, 16.031250000000004`}}], ",", 
   GraphicsBox[
    TagBox[RasterBox[CompressedData["
1:eJxTTMoPSmNiYGAo5gASQYnljkVFiZXBAkBOaF5xZnpeaopnXklqemqRRRJI
mREU/x8Fo2CQAg8GZDCNCB06pOr4C8osYXCwkrCOT0Adf4hwCgK8YGAwI0nD
/7sMDOGk6bjIwFBAmo6jDAztpOnYycAwmzQdaxgY1v5/eXHf7suv/hKnYx4D
Q2ksJPb0Vn8nRkc/coybHyNCx1ZhBq+NV9/9eHyyGKhF+BwRWh4cg7n/vCID
g8sPYhwGB8BwYzhMko7/gSRHTgcDQzppOlYzMASTpmMuA0MeaTqiGRgmEVJz
/wUSZzcwrC4R0PDJzeAonHNLnoEhnlDiWgY0NfsIODm9msDPwKByn5Cj/i4G
KmMQ88pK0wOlK43LhDQAweNyREIsfkWEBiB4s7U61kbSOnXBA+LUj4JRgAEA
qRIl8w==
      "], {{0, 16.031250000000004`}, {16.031250000000004`, 0}}, {0, 255},
      ColorFunction->GrayLevel,
      ImageResolution->224.56140350877192`],
     BoxForm`ImageTag["Byte", ColorSpace -> "Grayscale", Interleaving -> None],
     Selectable->False],
    DefaultBaseStyle->"ImageGraphics",
    ImageSizeRaw->{16.031250000000004`, 16.031250000000004`},
    PlotRange->{{0, 16.031250000000004`}, {0, 16.031250000000004`}}], ",", 
   GraphicsBox[
    TagBox[RasterBox[CompressedData["
1:eJxTTMoPSmNiYGAo5gASQYnljkVFiZXBAkBOaF5xZnpeaopnXklqemqRRRJI
mREU/x8Fo2AQgzebijzkzSMnnP5LnPrv82UYoCDwDDEaPiaC1NolxhqA6FWE
NfwMY2AQnvYUyPp3u5jB4AFhHVMZGHSuwTjHbxPW8BDokguElSGBCQwMXSRp
+C7PwECE05HAFQaGCJI0/F/FwDCFNB31DAz7/v//vLPITSW6Zc1XInRkA0Pq
90YtaJRb7vtHUEc4A8PZTAYG664l04rUgHrWEtThCIw/Brfj4BT4romBQeYJ
IR1eQHMbv0M5/4BuLCKkI56BoRWRxB8Akxgh35eAwwoG/ikyMBBKWQsYGCYj
cWOAAUFAxykGhmgkrhsDwxUCOr6qMHA9gvO+AMPhBQEd/ycyMOTDOdsZGPwI
afj/HOjZrVD2Kw0Ghk0EdfzfCnRJ+xcQ67gl0FO/CesABRcDf2h7pR2Q9npH
hIb///dbwwqfpi9Eafj//9vuKi9FvcjZ94lUPwpGARoAAM5JGxk=
      "], {{0, 16.031250000000004`}, {16.031250000000004`, 0}}, {0, 255},
      ColorFunction->GrayLevel,
      ImageResolution->224.56140350877192`],
     BoxForm`ImageTag["Byte", ColorSpace -> "Grayscale", Interleaving -> None],
     Selectable->False],
    DefaultBaseStyle->"ImageGraphics",
    ImageSizeRaw->{16.031250000000004`, 16.031250000000004`},
    PlotRange->{{0, 16.031250000000004`}, {0, 16.031250000000004`}}]}], 
  "}"}]], "Output",
 CellChangeTimes->{
  3.918636222071903*^9, {3.918637390474905*^9, 3.918637402648902*^9}, 
   3.918653710737095*^9, 3.918653938335911*^9, 3.9186542270253696`*^9, 
   3.9186621284529333`*^9, 3.918662175781335*^9, 3.918704171043249*^9},
 CellLabel->"Out[5]=",ExpressionUUID->"44b6642d-5a87-470a-b551-dfc1237fb843"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"Graphics3D", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"Opacity", "[", "0.1", "]"}], ",", 
     RowBox[{"Point", "[", 
      RowBox[{"topoint", "@@@", 
       RowBox[{"RandomChoice", "[", 
        RowBox[{"dist", ",", "10000"}], "]"}]}], "]"}]}], "}"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"ViewProjection", "->", "\"\<Orthographic\>\""}], ",", 
   RowBox[{"Boxed", "->", "False"}]}], "]"}]], "Input",
 CellChangeTimes->{
  3.918634792733945*^9, {3.9186348796527557`*^9, 3.918634881315874*^9}, {
   3.918635003236377*^9, 3.91863506216321*^9}, {3.918635206669595*^9, 
   3.918635211786743*^9}, {3.918635300042725*^9, 3.918635305338122*^9}},
 CellLabel->"In[9]:=",ExpressionUUID->"d936e7bc-8b73-47cc-8277-71c50fcc13d2"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"SetDirectory", "[", 
   RowBox[{"NotebookDirectory", "[", "]"}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Export", "[", 
   RowBox[{"\"\<coords.data\>\"", ",", 
    RowBox[{"topoint", "@@@", 
     RowBox[{"RandomChoice", "[", 
      RowBox[{"dist", ",", "10000"}], "]"}]}], ",", "\"\<Real32\>\""}], "]"}],
   ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Export", "[", 
   RowBox[{"\"\<quats.data\>\"", ",", 
    RowBox[{"quat", "/@", "mxs"}], ",", "\"\<Real32\>\""}], "]"}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.918661221252852*^9, 3.918661243484088*^9}, {
   3.918661297015787*^9, 3.9186613239618073`*^9}, 3.9186617960408497`*^9, {
   3.918668818113967*^9, 3.918668821705435*^9}, {3.918716589435231*^9, 
   3.918716597162475*^9}, {3.918716662578289*^9, 3.91871666413805*^9}},
 CellLabel->"In[55]:=",ExpressionUUID->"f01546ee-eea1-4e46-9db5-9c91e4c9961c"]
},
WindowSize->{606, 665.25},
WindowMargins->{{Automatic, 179.25}, {0, Automatic}},
Magnification:>1. Inherited,
FrontEndVersion->"13.3 for Linux x86 (64-bit) (July 24, 2023)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"97e2fece-5a92-40a4-8a57-ba56b64bf384"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 4934, 141, 442, "Input",ExpressionUUID->"bc950db2-1610-4d34-a3dd-411ab76877fb"],
Cell[CellGroupData[{
Cell[5517, 165, 2470, 64, 230, "Input",ExpressionUUID->"c4919180-04bb-451b-974f-075b534c4263"],
Cell[7990, 231, 5632, 109, 36, "Output",ExpressionUUID->"44b6642d-5a87-470a-b551-dfc1237fb843"]
}, Open  ]],
Cell[13637, 343, 767, 17, 70, "Input",ExpressionUUID->"d936e7bc-8b73-47cc-8277-71c50fcc13d2"],
Cell[14407, 362, 925, 21, 90, "Input",ExpressionUUID->"f01546ee-eea1-4e46-9db5-9c91e4c9961c"]
}
]
*)

